<div class="row">
    <div class="col-md-12">
        <div class="row">
            <div>
                <h1>Consulta</h1>
            </div>
        </div>
       
        <!-- Caso não tenho selecionado o paciente exibe este card que é usado para busca o paciente-->
        <nb-card *ngIf="!selecionouPaciente">
            <nb-card-body>
                <div class="input-group">
                    <label>Para iniciar a consulta selecione um paciente: </label>
                    <div class="input-group">
                        <input type="text" [(ngModel)]="pacienteSelecionado" class="form-control" placeholder="Insira o nome do paciente">
                            <span class="input-group-append">
                                <button class="btn btn-success btn-demo" (click)="buscarPacientes(pacienteSelecionado)">
                                    Buscar
                                </button>
                            </span>
                    </div>
                    <div class="col-md-12">
                        <nb-tabset fullWidth>  
                            <nb-tab tabTitle="Resultados">   
                                <div class="contact" *ngFor="let c of listaDeClientesBusca">
                                    <nb-user [picture]="c.foto" [name]="c.nome" [title]="c.email" size="large"></nb-user>
                                    <button class="btn btn-success btn-demo"  (click)="usuarioSelecionado(c._id)">Selecionar</button>
                                </div>   
                            </nb-tab>    
                        </nb-tabset> 
                    </div>
                </div>
            </nb-card-body>
        </nb-card>

        <!-- Informações da antropometria-->
        <nb-card *ngIf="selecionouPaciente">
            <nb-card-header>
                Antropometria
            </nb-card-header>    
            <nb-card-body>
                <div class="row">
                    <div class="col-md-8">
                        <div class="col">               
                            <div class="row">
                                <div class="col-md-4 bottom-spacing">
                                    <div class="">
                                        <label>Peso (kg) {{peso}}</label>
                                        <input  [(ngModel)]="peso" [class.form-control-danger]="validadorPeso" (keyup)="calculaIMC(); validadorPeso=false" type="number" min="0" placeholder="KG" class="form-control"/>
                                    </div>
                                </div>
                                <div class="col-md-4 bottom-spacing">
                                    <div class="">
                                        <label>Altura (m)</label>
                                        <input [(ngModel)]="altura" [class.form-control-danger]="validadorAltura" (keyup)="calculaIMC(); validadorAltura=false" type="number" min="0" placeholder="metros" class="form-control"/>
                                    </div>
                                </div>
                                <div class="col-md-4 bottom-spacing">
                                    <div class="">
                                        <label>% de gordura</label>{{gordura}}
                                        <input [(ngModel)]="gordura" [class.form-control-danger]="validadorGordura" (keyup)="calculaIMC(); validadorGordura=false" type="number" min="0" placeholder="%" class="form-control"/>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 input-group">
                                <div class="col">
                                    <label>Peso Ideal (kg)</label>
                                    <input readonly [(ngModel)]="pesoIdeal" type="number" min="0" placeholder="KG" class="form-control"/>
                                </div>
                            </div>
                            <div class="col-md-6 input-group">
                                <div class="col">
                                    <label>IMC</label>
                                    <input readonly [(ngModel)]="imc" type="number" placeholder="KG" class="form-control"/>
                                </div>
                            </div>   
                        </div>
                    </div>
                    <div class="col-md-4"> 
                            <div class="margemUsuario">
                                <nb-user [picture]="cliente.foto" [name]="cliente.nome" [title]="cliente.email" size="xlarge"></nb-user>
                                <br>
                                <button class="btn btn-success btn-semi-round btn-demo margemUsuario" (click)="showModalAnamnese(cliente._id)">Ver Anamnese</button>
                                <button class="btn btn-danger btn-semi-round btn-demo margemUsuario" (click)="cancelaAnamnese()">X</button>
                            </div>          
                    </div>
                </div>


                <div class="row">
                    <div class="col-md-12 input-group">
                        <div class="col">
                            <label>Deficiências</label>
                            <input [(ngModel)]="deficiencias"  type="text" placeholder="Ex: Vitamina C" class="form-control"/>
                        </div>
                    </div>
                    <div class="col-md-12 input-group">
                        <div class="col">
                            <label>Excessos</label>
                            <input [(ngModel)]="excessos" type="text" placeholder="Excessos" class="form-control"/>
                        </div>
                    </div>
                    <div class="col-md-12 input-group">
                        <div class="col">
                            <label>Observações</label>
                            <textarea [(ngModel)]="observacoes" rows="2" placeholder="Observações" class="form-control"></textarea>
                        </div>
                    </div>
                </div>
            </nb-card-body>
        </nb-card>
        
        <!-- Informações do cardápio-->
        <nb-card *ngIf="selecionouPaciente" [class.nb-card-teste]="validadorCardapio">
            <nb-card-header>
                Cardápio
            </nb-card-header> 
            <nb-card-body>
                <div class="row">
                    <div class="col-md-1"></div>
                    <div id="parent" class="col-md-2" (click)="seleciouTipoRefeicao('CAFE_DA_MANHA')"><div class="col"><img [src]="imagem_cafe_da_manha" class="block center"  height="40" width="40"><br><label>Café da manhã</label></div></div>
                    <div id="parent" class="col-md-2" (click)="seleciouTipoRefeicao('LANCHE_DA_MANHA')"><div class="col"><img [src]="imagem_lanche_da_manha" class="block center"   height="40" width="40"><br><label>Lanche da manhã</label></div></div>
                    <div id="parent" class="col-md-2" (click)="seleciouTipoRefeicao('ALMOCO')"><div class="col"><img [src]="imagem_almoco" class="block center"   height="40" width="40"><br><label>Almoço</label></div></div>
                    <div id="parent" class="col-md-2" (click)="seleciouTipoRefeicao('LANCHE')"><div class="col"><img [src]="imagem_lanche" class="block center"   height="40" width="40"><br><label>Lanche</label></div></div>
                    <div id="parent" class="col-md-2" (click)="seleciouTipoRefeicao('JANTA')"><div class="col"><img [src]="imagem_janta" class="blockmax center"   height="40" width="40"><br><label>Jantar</label></div></div>
                    <div class="col-md-1"><!-- gambiarra de espaçamento--></div>
                </div> 
               
                <div class="font-row font-main" style="background:#f8f8fd; margin: 10px">
                    <div style="margin: 20px">
                        <div class="header">
                            <div class="bold margemUsuario"><h5>Componentes</h5></div>
        
                            <div>
                                <button class="btn btn-success btn-semi-round btn-demo" (click)="showGruposModal()">Ver grupos</button>
                            </div>
                        </div>
                        
                        <nb-card>
                            <nb-card-body>
                                <div class="row">
                                    <div class="col-md-2">
                                        <label>Porções:</label> 
                                        <input class="form-control" type="number" min="0" [(ngModel)]="porcoes" >   
                                    </div>
                                    <div class="col-md-2"></div>
                                    <div class="col-md-4">
                                        <label>Grupo:</label>
                                        <select class="form-control" [(ngModel)]="grupoSelecionadoId">
                                            <option *ngFor="let grupo of grupos" id={{grupo._id}} [ngValue]="grupo._id">{{grupo.titulo}}</option>
                                        </select>   
                                    </div>
                                    <div class="col-md-2"></div>
                                    <div class="col-md-2" >
                                        <button class="btn btn-info btn-semi-round btn-demo margemComposicaoBtn" style="float:right;" (click)="addComposicao()">Adicionar</button> 
                                    </div>
                                </div>

                                

                            </nb-card-body>
                        </nb-card>
                        

                        <nb-card *ngFor="let composicao of lista_composicao_selecionada">
                            <nb-card-body>
                                <div class="row">
                                    <div class="col-md-4 margemTopzera">
                                        <label>Quantidade de porções:</label> 
                                        {{composicao.quantidade}}  
                                    </div>
                                    <div class="col-md-4 margemTopzera">
                                        <label>Grupo:</label>
                                        {{getTituloGrupoPorId(composicao.grupo)}}  
                                    </div>
                                    <div class="col-md-2"></div>
                                    <div class="col-md-2">
                                        <button class="btn btn-danger btn-semi-round btn-demo" 
                                                style="float:right;"
                                                (click)="deletarComposicao(composicao)">X</button> 
                                    </div>
                                </div>
                                <br>
                            </nb-card-body>
                        </nb-card>
                        <br>


                    </div>
                    <button class="btn btn-success btn-semi-round btn-demo" 
                            style="float:right;"
                            (click)="finalizarConsulta()">Finalizar consulta</button> 

                </div>  
                  
            </nb-card-body>
            <br>
        </nb-card>
        
    </div>
</div>
